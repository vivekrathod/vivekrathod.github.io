---
title: Invalid XML characters
date: 2014-01-21 16:41:00 Z
layout: post
author: Vivek Rathod
modified_time: '2014-02-16T22:18:27.399-05:00'
blogger_id: tag:blogger.com,1999:blog-3203466822740858620.post-1365535859000511441
blogger_orig_url: https://blog.vivekrathod.com/2014/01/invalid-xml-characters.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">Recently I investigated an issue with one of our WCF based services where the clientâ€™s XML parser (Java SAX) complained of invalid XML characters. <br /><blockquote><pre class="csharpcode">org.xml.sax.SAXParseException; lineNumber: 6; columnNumber: 24; Character reference "&amp;#<br />    at com.sun.org.apache.xerces.<span class="kwrd">internal</span>.parsers.AbstractSAXParser.parse(Unknown Source)<br />    at com.sun.org.apache.xerces.<span class="kwrd">internal</span>.jaxp.SAXParserImpl$JAXPSAXParser.parse(Unknown Source)<br />    at org.xml.sax.helpers.XMLFilterImpl.parse(Unknown Source)<br />    at org.apache.xalan.transformer.TransformerIdentityImpl.transform(TransformerIdentityImpl.java:485)</pre></blockquote><br />Although the character that caused the exception was not shown here, one of my colleagues used the <a href="http://msdn.microsoft.com/en-us/library/bb552364(v=vs.110).aspx" target="_blank">WCFTestClient</a> to get at the actual SOAP message (see below) and it showed some interesting looking characters like <em>&amp;#x6;</em> and &amp;#x2;&nbsp; in the message field.<br /><br /><blockquote><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">s:Envelope</span> <span class="attr">xmlns:s</span><span class="kwrd">="http://www.w3.org/2003/05/soap-envelope"</span> <span class="attr">xmlns:a</span><span class="kwrd">="http://www.w3.org/2005/08/addressing"</span><span class="kwrd">&gt;</span><br />  <span class="kwrd">&lt;</span><span class="html">s:Header</span><span class="kwrd">&gt;</span><br />    <span class="kwrd">&lt;</span><span class="html">a:Action</span> <span class="attr">s:mustUnderstand</span><span class="kwrd">="1"</span><span class="kwrd">&gt;</span>.../GetErrorsResponse<span class="kwrd">&lt;/</span><span class="html">a:Action</span><span class="kwrd">&gt;</span><br />    <span class="kwrd">&lt;</span><span class="html">a:RelatesTo</span><span class="kwrd">&gt;</span>urn:uuid:96e19d12-29c6-4e62-9f97-3f69bed539c6<span class="kwrd">&lt;/</span><span class="html">a:RelatesTo</span><span class="kwrd">&gt;</span><br />  <span class="kwrd">&lt;/</span><span class="html">s:Header</span><span class="kwrd">&gt;</span><br />  <span class="kwrd">&lt;</span><span class="html">s:Body</span><span class="kwrd">&gt;</span><br />    <span class="kwrd">&lt;</span><span class="html">GetErrorsResponse</span> <span class="attr">xmlns</span><span class="kwrd">="AppSecInc.Checks.Service"</span><span class="kwrd">&gt;</span><br />      <span class="kwrd">&lt;</span><span class="html">GetErrorsResult</span> <span class="attr">xmlns:b</span><span class="kwrd">="http://schemas.datacontract.org/2004/07/.."</span> <span class="attr">xmlns:i</span><span class="kwrd">="http://www.w3.org/2001/XMLSchema-instance"</span><span class="kwrd">&gt;</span><br />        ...<br />        <span class="kwrd">&lt;</span><span class="html">b:Error</span> <span class="attr">i:type</span><span class="kwrd">="b:ScanError"</span><span class="kwrd">&gt;</span><br />          <span class="kwrd">&lt;</span><span class="html">b:Message</span><span class="kwrd">&gt;</span>..: Exception Information<br />           Exception type=WeOnlyDo.Exceptions.SSH.TimeoutException<br />           Message=Timeout occurred due to inactivity.<br />           Source=WeOnlyDo.Client.SSH<br />           Data=System.Collections.ListDictionaryInternal<br />           StackTrace=   at &amp;#x6; .&amp;#x2;(String &amp;#x2;, String[]<span class="attr">&amp;amp;</span> &amp;#x3;, Int32 &amp;#x5;, Int32<span class="attr">&amp;amp;</span> &amp;#x8;, String<span class="attr">&amp;amp;</span> &amp;#x6;)<br />           at WeOnlyDo.Client.SSH.Execute(String Command, String Prompt, Int16 Timeout)<br />           ...<br /><span class="kwrd">          &lt;/</span><span class="html">b:Message</span><span class="kwrd">&gt;</span><br />          <span class="kwrd">&lt;</span><span class="html">b:Severity</span><span class="kwrd">&gt;</span>Error<span class="kwrd">&lt;/</span><span class="html">b:Severity</span><span class="kwrd">&gt;</span><br />          <span class="kwrd">&lt;</span><span class="html">b:Timestamp</span><span class="kwrd">&gt;</span>2013-12-10T03:22:29<span class="kwrd">&lt;/</span><span class="html">b:Timestamp</span><span class="kwrd">&gt;</span><br />        <span class="kwrd">&lt;/</span><span class="html">b:Error</span><span class="kwrd">&gt;</span><br />        ...<br />      <span class="kwrd">&lt;/</span><span class="html">GetErrorsResult</span><span class="kwrd">&gt;</span><br />    <span class="kwrd">&lt;/</span><span class="html">GetErrorsResponse</span><span class="kwrd">&gt;</span><br />  <span class="kwrd">&lt;/</span><span class="html">s:Body</span><span class="kwrd">&gt;</span><br /><span class="kwrd">&lt;/</span><span class="html">s:Envelope</span><span class="kwrd">&gt;</span></pre></blockquote>Thanks to a <a href="http://stackoverflow.com/questions/730133/invalid-characters-in-xml/5110103#5110103" target="_blank">post on stackexchange</a> these did, in fact, turn out to be invalid XML characters. As per the <em><a href="http://www.w3.org/TR/xml/#charsets" target="_blank">Characters</a>&nbsp;</em>section of <a href="http://www.w3.org/TR/xml/#charsets" target="_blank">XML spec from W3C</a>&nbsp; only these characters are valid<br /><pre class="csharpcode">#x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]    /* any Unicode character, excluding the surrogate blocks, FFFE, and FFFF. */</pre><br />At least, by default, WCF does not seem to do anything special about them. I do not know if anything could be done at the WCF level, but I want to explore if an extension to WCF can be implemented that will filter such invalid characters.</div>